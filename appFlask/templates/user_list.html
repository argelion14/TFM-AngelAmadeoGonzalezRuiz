{% extends "base.html" %}

{% block title %}Users{% endblock %}
{% block active_module_user %}active{% endblock %}
{% block open_users %}-open{% endblock %}
{% block active_users %}active{% endblock %}
{% block header %}Registered Users{% endblock %}

{% block path_main %}
<li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
<li class="breadcrumb-item active" aria-current="page">Users</li>
{% endblock %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
  {{ message }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

{% block content %}
<div class="card">
  <div class="card-header">
    <h3 class="card-title">User List</h3>
  </div>
  <div class="card-body">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Certificate</th>
          <th>Roles</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in usuarios %}
        <tr>
          <td>{{ user['id'] }}</td>
          <td>{{ user['username'] }}</td>
          <td>
            {% if user['cert'] %}
            <code>{{ user['cert'] }}</code>
            {% else %}
            <span class="text-muted">No certificate</span>
            {% endif %}
          </td>
          <td>
            {% if user['roles'] %}
            <div
              style="max-height: 100px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.25rem; padding: 0.25rem; background-color: #f8f9fa;">
              <ul class="mb-0 pl-3">
                {% for role in user['roles'] %}
                <li style="font-size: 0.9rem;">{{ role }}</li>
                {% endfor %}
              </ul>
            </div>
            {% else %}
            <span class="text-muted">No roles</span>
            {% endif %}
          </td>
          <td>
            <a href="{{ url_for('user_detail', id=user['id']) }}" class="btn btn-primary btn-sm">
              <i class="fas fa-eye"></i> View
            </a>
            <a href="{{ url_for('editar_usuario', id=user['id']) }}" class="btn btn-info btn-sm">
              <i class="fas fa-edit"></i> Edit
            </a>
            <form action="{{ url_for('eliminar_usuario', id=user['id']) }}" method="post" style="display:inline;"
              onsubmit="return confirm('Are you sure you want to delete this user?');">
              <button type="submit" class="btn btn-danger btn-sm">
                <i class="fas fa-trash-alt"></i> Delete
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}